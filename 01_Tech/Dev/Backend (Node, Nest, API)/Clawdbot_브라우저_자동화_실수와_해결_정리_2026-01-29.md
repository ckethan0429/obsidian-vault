# Clawdbot 브라우저 자동화: 실수와 해결 정리 (2026-01-29)

## 한 줄 요약
- **실수:** Ubuntu에서 기본으로 쉽게 설치되는 **snap Chromium**을 전제로 clawd-managed browser launch를 시도함.
- **결과:** snap confinement(AppArmor) 때문에 Clawdbot의 profile user-data-dir(`~/.clawdbot/browser/...`)에서 락 파일 생성이 막혀 브라우저 시작이 불안정/실패.
- **해결:** **Google Chrome (deb)** 로 전환하고 Clawdbot 브라우저를 **로컬 런치 모드(CDP port)** 로 재설정 → `cdpReady=true`로 정상 동작.

---

## 내가 했던 실수(원인)
1) **snap Chromium을 그대로 사용**
- `/snap/bin/chromium` 환경에서 Clawdbot가 프로필을 띄울 때 `--user-data-dir=~/.clawdbot/browser/<profile>/user-data`를 사용함.
- 이 때 snap Chromium은 AppArmor confinement 때문에 특정 파일 작업을 거부할 수 있음.

2) (부차) XRDP 세션에서 GUI/브라우저 자동화를 장시간 시도
- XRDP(X11 :10) 세션은 로컬 콘솔 세션(gnome/gdm)과 그래픽 스택이 달라서,
  브라우저 자동화가 더 꼬일 확률이 있었음.

### 관측된 증상
- 브라우저 start가 타임아웃/실패:
  - `Can't reach ... /start?profile=clawd (timed out ...)`
- 커널 로그에서 AppArmor 거부:
  - `apparmor="DENIED" operation="symlink" ... ~/.clawdbot/browser/clawd/user-data/SingletonLock`

---

## 해결(내가 적용한 조치)
### 1) Google Chrome (deb) 설치
- snap Chromium 대신 **/usr/bin/google-chrome** 사용:
  - `google-chrome --version` → `Google Chrome 144.0.7559.109`
  - `which google-chrome` → `/usr/bin/google-chrome`

### 2) Clawdbot 브라우저를 “clawd-managed local launch”로 재설정
- 기존의 임시 우회(외부 CDP attach: `cdpUrl: http://127.0.0.1:9222`)를 제거하고,
- Clawdbot가 Chrome을 직접 띄우도록 설정.

적용한 설정 요약:
- `browser.enabled: true`
- `browser.executablePath: /usr/bin/google-chrome`
- `browser.defaultProfile: clawd`
- `browser.profiles.clawd.cdpPort: 18800`

### 3) Gateway 재시작 후 브라우저 시작 확인
- `clawdbot browser start --browser-profile clawd`
- 결과:
  - `running: true`
  - `cdpReady: true`
  - `cdpUrl: http://127.0.0.1:18800`
  - `userDataDir: /home/ck/.clawdbot/browser/clawd/user-data`
  - `pid` 할당됨

---

## 결론 / 교훈
- Ubuntu에서 **브라우저 자동화는 snap Chromium을 피하는 게 안전**하다.
- clawd-managed browser를 안정적으로 쓰려면:
  - (권장) **Google Chrome(deb)** 또는 non-snap Chromium
  - clawd가 직접 launch하는 **CDP port 방식**
- Relay(확장) 방식은 유효한 우회지만, 장기적으로는 로컬 런치 구성이 더 깔끔하다.

